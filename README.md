# UniWorlds NFT Metadata Generator

Production-ready tooling to generate 1,337 per-token JSON metadata files from CSV for IPFS upload and NFT reveal.

## Overview

This project generates OpenSea-compatible metadata JSON files for the **UniWorlds** NFT collection, deriving traits from a CSV file and linking to IPFS-hosted images.

**What it does:**
- ✅ Validates CSV structure (1,337 rows, no duplicates, sequential token IDs)
- ✅ Validates all referenced images exist
- ✅ Generates 1,337 JSON files: `metadata/1.json` through `metadata/1337.json`
- ✅ Extracts attributes from CSV columns (`attributes[Trait Name]`)
- ✅ Supports dry-run mode to catch errors before generating files
- ✅ Includes CID patching tool for post-IPFS-upload

## Collection Info

- **Collection Name**: UniWorlds
- **Total Supply**: 1,337 NFTs
- **Blockchain**: Polygon (MATIC)
- **OpenSea Collection**: [https://opensea.io/collection/uniworlds](https://opensea.io/collection/uniworlds)
- **Contract**: View on [OpenSea collection page](https://opensea.io/collection/uniworlds) → Click "Details" → Find PolygonScan contract link

## Prerequisites

- **Node.js** (v14 or higher) - [Download](https://nodejs.org/)
- **Git Bash** or **PowerShell** (Windows) or **Terminal** (Mac/Linux)
- Your 1,337 PNG images in an `images/` folder

## Project Structure

```
NFT-stuff/
├── metadata.csv           # Your CSV with token data (already present)
├── images/                # Create this folder and add your 1337 PNGs
│   ├── Aam_115.png
│   ├── Abchania_Two.png
│   └── ...
├── metadata/              # Generated by script (output folder)
│   ├── 1.json
│   ├── 2.json
│   └── ...
├── generate-metadata.js   # Main generation script
├── patch-cid.js          # CID patching script
├── package.json          # Dependencies
└── README.md             # This file
```

## Setup Instructions (Windows)

### Step 1: Install Dependencies

Open **Git Bash** or **PowerShell** in the project folder and run:

```bash
npm install
```

This installs `csv-parse` and `fs-extra` libraries.

### Step 2: Prepare Your Images Folder

1. Create an `images/` folder in the project root:
   ```bash
   mkdir images
   ```

2. Copy all 1,337 PNG files into the `images/` folder

3. Verify the filenames match those in `metadata.csv` (column: `file_name`)

**Important:** Image filenames in the CSV must exactly match the actual files (case-sensitive on some systems).

### Step 3: Run Dry-Run Validation

Before generating any files, validate everything:

```bash
npm run dry-run
```

or:

```bash
node generate-metadata.js --dry-run
```

**This will check:**
- ✅ CSV has exactly 1,337 rows
- ✅ Token IDs are 1-1337 with no gaps or duplicates
- ✅ All referenced images exist in `images/` folder
- ✅ No missing data in critical fields

**Expected output:**
```
======================================================================
Step 1: Reading CSV
======================================================================
[✓] Loaded 1337 records from metadata.csv

======================================================================
Step 2: Validating CSV Structure
======================================================================
[✓] CSV structure validation passed

======================================================================
Step 3: Validating Images
======================================================================
[INFO] Found 1337 PNG files in images folder
[✓] Image validation passed

======================================================================
Step 4: Dry Run Complete
======================================================================
[✓] All validations passed!
[INFO] Ready to generate 1337 metadata JSON files
```

### Step 4: Generate Metadata Files

Once dry-run passes, generate the metadata:

```bash
npm run generate
```

or:

```bash
node generate-metadata.js
```

**This will:**
1. Create a `metadata/` folder
2. Generate 1,337 JSON files (1.json through 1337.json)
3. Each JSON contains:
   - `name`: Planet name from CSV
   - `description`: Unique description per token
   - `image`: `ipfs://__IMAGES_CID_PLACEHOLDER__/<filename>`
   - `attributes`: Array of traits from CSV
   - `external_url`: Link to your website

**Expected output:**
```
======================================================================
Summary
======================================================================
[✓] Successfully generated: 1337 files

[INFO] Next steps:
[INFO] 1. Upload images/ folder to IPFS → get IMAGES_CID
[INFO] 2. Run: node patch-cid.js <IMAGES_CID>
[INFO] 3. Upload metadata/ folder to IPFS → get METADATA_CID
[INFO] 4. Set contract baseURI to: ipfs://<METADATA_CID>/
```

## Step 5: Upload Images to IPFS

Use one of these IPFS services:
- **Pinata**: https://pinata.cloud/
- **NFT.Storage**: https://nft.storage/
- **Web3.Storage**: https://web3.storage/

**Instructions:**
1. Upload the entire `images/` folder (not individual files)
2. Get the **CID** (Content Identifier) - example: `QmYwAPJzv5CZsnA625s3Xf2nemtYgPpHdWEz79ojWnPbdG`
3. **Test the URL** in your browser: `https://ipfs.io/ipfs/<YOUR_CID>/Aam_115.png`
4. Keep this CID - you'll need it for the next step

## Step 6: Patch the Images CID into Metadata

Replace the placeholder CID with your actual images CID:

```bash
node patch-cid.js QmYourActualImagesCID
```

**Example:**
```bash
node patch-cid.js QmYwAPJzv5CZsnA625s3Xf2nemtYgPpHdWEz79ojWnPbdG
```

This updates all `metadata/*.json` files, replacing `__IMAGES_CID_PLACEHOLDER__` with your real CID.

## Step 7: Upload Metadata to IPFS

1. Upload the entire `metadata/` folder to IPFS
2. Get the **METADATA_CID** - example: `QmAbCdEf123456789...`
3. **Test a token URL**: `https://ipfs.io/ipfs/<METADATA_CID>/1.json`

## Step 8: Update Your Smart Contract

Set your contract's `baseURI` to:

```
ipfs://<METADATA_CID>/
```

**Example in Solidity:**
```solidity
function setBaseURI(string memory baseURI) external onlyOwner {
    _baseTokenURI = "ipfs://QmAbCdEf123456789.../";
}
```

Your token URIs will now resolve to:
- Token 1: `ipfs://<METADATA_CID>/1.json`
- Token 2: `ipfs://<METADATA_CID>/2.json`
- ...
- Token 1337: `ipfs://<METADATA_CID>/1337.json`

## Validation Checklist

Before uploading to IPFS, verify:

- [ ] Dry-run completed with no errors
- [ ] `metadata/` folder contains exactly 1,337 JSON files
- [ ] All filenames are `1.json` through `1337.json` (no gaps)
- [ ] Sample a few JSON files manually (check structure)
- [ ] All referenced images exist in `images/` folder
- [ ] Image filenames in JSONs match actual files
- [ ] `images/` folder contains exactly 1,337 PNG files
- [ ] No duplicate token IDs in CSV
- [ ] Attributes look correct (check a few tokens)

## Troubleshooting

### Error: "Missing image files"
- **Fix**: Ensure all PNG files are in the `images/` folder with exact filenames from CSV

### Error: "Duplicate token IDs found"
- **Fix**: Check your CSV for duplicate `tokenID` values

### Error: "Missing token IDs"
- **Fix**: Ensure your CSV has all IDs from 1 to 1337 with no gaps

### Error: "CSV file not found"
- **Fix**: Ensure `metadata.csv` is in the project root folder

### Images not loading in OpenSea
- **Fix**: Verify IPFS URLs are accessible via `https://ipfs.io/ipfs/<CID>/filename.png`
- **Fix**: Ensure you patched the CID correctly (check a sample JSON file)

## Configuration

To customize settings, edit `generate-metadata.js` and modify the `CONFIG` object:

```javascript
const CONFIG = {
  csvPath: 'metadata.csv',              // CSV file path
  imagesFolder: 'images',               // Images folder
  outputFolder: 'metadata',             // Output folder
  collectionName: 'UniWorlds',          // Collection name
  expectedTokenCount: 1337,             // Total tokens
  tokenIdColumn: 'tokenID',             // Token ID column
  imageFilenameColumn: 'file_name',     // Image filename column
  // ... more settings
};
```

## Example Output

See `EXAMPLE_OUTPUT.md` for a sample `870.json` file.

## Scripts Reference

| Command | Description |
|---------|-------------|
| `npm install` | Install dependencies |
| `npm run dry-run` | Validate without generating files |
| `npm run generate` | Generate all metadata JSON files |
| `npm run patch-cid` | Patch images CID (requires CID arg) |

## CSV Format

Your `metadata.csv` should have:
- **tokenID**: 1-1337 (no gaps, no duplicates)
- **name**: Planet name
- **file_name**: PNG filename (e.g., `Aam_115.png`)
- **description**: Unique description per token
- **attributes[Trait Name]**: Columns for traits (e.g., `attributes[Type]`)
- **external_url**: Optional website link

Empty attribute values are automatically skipped.

## Support

If you encounter issues:
1. Check the error message carefully
2. Verify your CSV format matches the expected structure
3. Ensure image filenames match exactly (case-sensitive)
4. Run dry-run mode to diagnose problems

## License

MIT
